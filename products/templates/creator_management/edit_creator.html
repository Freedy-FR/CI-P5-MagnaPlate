{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Edit Creator{% endblock %}
{% block meta_keywords %}edit creator, MagnaPlate creator, update artist profile, admin panel{% endblock %}
{% block meta_description %}
  Edit existing creator profiles on MagnaPlate. Keep your platform updated by modifying artist details.
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'products/css/product.css' %}">
{% endblock %}

{% block content %}
<!-- Main container for the Edit Creator page -->
<section class="container mt-5">
    <hr>
    <h2 class="logo-font mb-4 text-center">Edit Creator</h2>
    <hr>
    <!-- Form for editing a creator -->
    <form id="creatorForm" method="POST" action="{% url 'edit_creator' form.instance.pk %}" class="form mb-2" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form|crispy }}

        <!-- Preview Card -->
        <section class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4 mt-4" id="creatorPreview" style="display: none;">
            <div class="col g-3">
                <div class="card p-0">
                    <a class="link-underline-opacity-0 link" href="#">
                        <img id="imagePreview" src="#" alt="Image Preview" style="display: none;" class="card-img img-fluid img-fill">
                        <div class="card-body">
                            <h5 class="card-title" id="previewName">{{ form.instance.name }}</h5>
                            <p class="card-text text-truncate" id="previewDescription">{{ form.instance.description }}</p>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <div class="text-right">
            <a class="btn btn-secondary rounded-pill my-1 me-1" href="{% url 'creator_management' %}">Cancel</a>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary rounded-pill my-1" data-toggle="modal" data-target="#confirmCreatorModal">
                Update Creator
            </button>
        </div>
    </form>

    <!-- Modal for Confirm Update Creator -->
    <section class="modal fade" id="confirmCreatorModal" tabindex="-1" role="dialog" aria-labelledby="confirmCreatorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-white text-dark d-flex justify-content-between">
                    <h5 class="modal-title" id="confirmCreatorModalLabel">Confirm Update Creator</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to update this creator?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-pill my-1 me-1" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary rounded-pill my-1" onclick="document.getElementById('creatorForm').submit();">Update Creator</button>
                </div>
            </div>
        </div>
    </section>
</section>
{% endblock %}

{% block postloadjs %}
<script>
    // Function to display preview image
    document.getElementById('id_image').onchange = function (event) {
        var reader = new FileReader();
        reader.onload = function () {
            var output = document.getElementById('imagePreview');
            output.src = reader.result;
            output.style.display = 'block';
            document.getElementById('creatorPreview').style.display = 'flex';
        };
        reader.readAsDataURL(event.target.files[0]);
    };

    // Function to update name preview
    document.getElementById('id_name').onkeyup = function (event) {
        var name = event.target.value;
        document.getElementById('previewName').innerText = name;
        document.getElementById('creatorPreview').style.display = 'flex';
    };

    // Function to update description preview
    document.getElementById('id_description').onkeyup = function (event) {
        var description = event.target.value;
        document.getElementById('previewDescription').innerText = description;
        document.getElementById('creatorPreview').style.display = 'flex';
    };

    // Initialize the preview with existing data
    window.onload = function () {
        var existingImage = "{{ form.instance.image.url }}";
        if (existingImage) {
            var output = document.getElementById('imagePreview');
            output.src = existingImage;
            output.style.display = 'block';
            document.getElementById('creatorPreview').style.display = 'flex';
        }
        var existingName = document.getElementById('id_name').value;
        if (existingName) {
            document.getElementById('previewName').innerText = existingName;
            document.getElementById('creatorPreview').style.display = 'flex';
        }
        var existingDescription = document.getElementById('id_description').value;
        if (existingDescription) {
            document.getElementById('previewDescription').innerText = existingDescription;
            document.getElementById('creatorPreview').style.display = 'flex';
        }
    };
</script>
{% endblock %}
