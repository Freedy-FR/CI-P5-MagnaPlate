{% extends "base.html" %}
{% load static %}

{% block title %}Carousel Management{% endblock %}
{% block meta_keywords %}carousel management, MagnaPlate carousel, manage homepage images, admin panel{% endblock %}
{% block meta_description %}
  Manage the images displayed on the MagnaPlate homepage carousel. Ensure your site looks great by organizing and updating carousel images.
{% endblock %}

{% block extra_css %}
<!-- Link to additional CSS for product styling -->
<link rel="stylesheet" href="{% static 'products/css/product.css' %}">
{% endblock %}

{% block content %}
<!-- Main container for the Carousel Management page -->
<div class="container py-4">
    <hr>
    <h2 class="logo-font mb-4 text-center">Carousel Management</h2>
    <hr>

    <!-- Table displaying the carousel items -->
    <table class="table mt-4">
        <thead>
            <tr>
                <th>Image</th>
                <th>Link</th>
                <th>Caption</th>
                <th>Order</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in carousels %}
            <tr>
                <td><img src="{{ item.image.url }}" alt="image {{ item.order }}" width="100" class="img-fluid"></td>
                <td>{{ item.link }}</td>
                <td>{{ item.caption }}</td>
                <td>{{ item.order }}</td>
                <td>
                    <div class="d-flex justify-content-between">
                        <!-- Edit button -->
                        <a href="{% url 'carousel_update' item.id %}" class="btn btn-primary rounded-pill my-2">Edit</a>
                        <!-- Delete button triggering modal -->
                        <button type="button" class="btn btn-danger rounded-pill my-2 me-1" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-item-id="{{ item.id }}" data-item-caption="{{ item.caption }}">Delete</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Navigation buttons -->
    <div class="row mt-4">
        <div class="col-6 text-center">
            <a href="{% url 'site_management' %}" class="btn btn-secondary rounded-pill my-1 me-1">Back to Management</a>
        </div>
        <div class="col-6 text-center">
            <a href="{% url 'carousel_create' %}" class="btn rounded-pill my-2 border-black btn-success">Add New Item</a>
        </div>
    </div>
</div>

<!-- Modal for Delete Confirmation -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-white text-dark d-flex justify-content-between">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete <span id="modalItemCaption"></span>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary rounded-pill my-1 me-1" data-bs-dismiss="modal">Cancel</button>
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger rounded-pill my-1 me-1">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block postloadjs %}
<!-- JavaScript to handle delete confirmation modal -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var confirmDeleteModal = document.getElementById('confirmDeleteModal');
        confirmDeleteModal.addEventListener('show.bs.modal', function(event) {
            var button = event.relatedTarget;
            var itemId = button.getAttribute('data-item-id');
            var itemCaption = button.getAttribute('data-item-caption');
            var formAction = "{% url 'carousel_delete' 1 %}".replace('1', itemId);

            var modalBodyItemCaption = confirmDeleteModal.querySelector('#modalItemCaption');
            modalBodyItemCaption.textContent = itemCaption;

            var deleteForm = confirmDeleteModal.querySelector('#deleteForm');
            deleteForm.setAttribute('action', formAction);
        });
    });
</script>
{% endblock %}
